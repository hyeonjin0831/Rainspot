<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RainSpot ì˜ˆì¸¡ ëŒ€ì‹œë³´ë“œ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f8fafc; }
        @keyframes pulse-bar {0% { opacity: 0.7; } 50% { opacity: 1; } 100% { opacity: 0.7; }}
        .animate-pulse-bar { animation: pulse-bar 1.5s infinite; }
    </style>
</head>
<body class="bg-gray-50 min-h-screen flex items-start justify-center p-4">
<div id="rainspot-app" class="w-full max-w-md bg-white shadow-2xl rounded-2xl overflow-hidden mt-8">

    <header class="p-5 bg-gradient-to-r from-blue-600 to-indigo-700 text-white shadow-lg">
        <p class="text-sm opacity-80" id="currentDateTime"></p>
        <div class="flex items-center justify-between mt-1 cursor-pointer" onclick="changeLocation()">
            <div class="flex items-center space-x-2">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-5 h-5">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M15 10.5a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" />
                    <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 10.5c0 7.142-7.5 11.25-7.5 11.25S4.5 17.642 4.5 10.5a7.5 7.5 0 1 1 15 0Z" />
                </svg>
                <p id="locationDisplay" class="font-semibold text-lg transition-colors duration-300 hover:text-blue-200">
                    ìœ„ì¹˜ ì ‘ê·¼ ì¤‘...
                </p>
            </div>
        </div>

        <div class="flex items-center justify-between mt-4">
            <p class="text-4xl font-bold" id="currentTemp">?</p>
            <div class="text-3xl" id="weatherIcon">?</div>
        </div>
    </header>

    <main class="p-6">
        <h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
            ì†Œë‚˜ê¸° ì˜ˆì¸¡ (RainSpot Nowcasting)
        </h2>

        <div class="bg-gray-100 p-4 rounded-lg shadow-inner mb-4">
            <div class="flex justify-between items-end mb-2">
                <p class="text-sm font-medium text-gray-600">ì˜ˆì¸¡ í™•ë¥ </p>
                <p id="riskEmoji" class="text-2xl font-extrabold"></p>
            </div>
            
            <div class="w-full bg-gray-300 rounded-full h-4 relative">
                <div id="probBar" class="h-4 rounded-full transition-all duration-1000 ease-out" style="width: 0%;" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
            </div>

            <div class="flex justify-between mt-1 text-sm font-semibold text-gray-800">
                <p class="text-blue-600">0%</p>
                <p id="probDisplay" class="text-xl font-extrabold">0%</p>
                <p class="text-red-600">100%</p>
            </div>
        </div>

        <div id="statusMentContainer" class="p-3 rounded-lg text-center font-semibold text-white mb-4 transition-all duration-300" style="min-height: 48px; opacity: 0;">
            <p id="statusMent"></p>
        </div>
        
        <div class="grid grid-cols-2 gap-4 text-center">
            <div class="p-4 bg-gray-50 rounded-lg shadow transition-all duration-300">
                <p class="text-xs font-medium text-gray-500 mb-1">ğŸ’§ ìŠµë„</p>
                <p id="humidityDisplay" class="text-2xl font-bold text-blue-800">0%</p>
            </div>
            <div class="p-4 bg-gray-50 rounded-lg shadow transition-all duration-300">
                <p class="text-xs font-medium text-gray-500 mb-1">ğŸ“‰ ê¸°ì••</p>
                <p id="pressureDisplay" class="text-2xl font-bold text-red-700">0</p>
            </div>
        </div>

        <p id="simStatus" class="text-center text-sm text-gray-500 mt-4 transition-colors duration-300"></p>
    </main>
</div>

<script>
const API_KEY = "91a2f1400f6b1f48086f5880e764a966";
let currentProb = 30;
let currentHumidity = 75.0;
let currentPressure = 1010.0;
let totalSimulatedSeconds = 0;

// DOM ì°¸ì¡°
const probBar = document.getElementById('probBar');
const probDisplay = document.getElementById('probDisplay');
const statusMentContainer = document.getElementById('statusMentContainer');
const statusMent = document.getElementById('statusMent');
const humidityDisplay = document.getElementById('humidityDisplay');
const pressureDisplay = document.getElementById('pressureDisplay');
const riskEmoji = document.getElementById('riskEmoji');
const currentTemp = document.getElementById('currentTemp');
const weatherIcon = document.getElementById('weatherIcon');
const locationDisplay = document.getElementById('locationDisplay');
const currentDateTime = document.getElementById('currentDateTime');

function getStatusEmphasis(prob){
    if(prob>70) return {emoji:"â˜”", ment:"âš¡ ê°•í•œ ì†Œë‚˜ê¸° ê²½ë³´!", color:"bg-red-600"};
    if(prob>40) return {emoji:"â—", ment:"ğŸ’§ ì†Œë‚˜ê¸° ê°€ëŠ¥ì„± ë†’ìŒ", color:"bg-yellow-500"};
    return {emoji:"ğŸ˜Š", ment:"âœ… í˜„ì¬ê¹Œì§€ ì†Œë‚˜ê¸° ë‚®ìŒ", color:"bg-green-500"};
}

function updateUI(prob, humidity, pressure, statusData){
    probBar.style.width = prob + "%";
    probDisplay.textContent = Math.round(prob)+"%";
    probBar.className = `h-4 rounded-full transition-all duration-1000 ease-out ${statusData.color}`;
    riskEmoji.textContent = statusData.emoji;
    statusMent.textContent = statusData.ment;
    statusMentContainer.className = `p-3 rounded-lg text-center font-semibold text-white mb-4 transition-all duration-300 ${statusData.color}`;
    humidityDisplay.textContent = humidity.toFixed(1)+"%";
    pressureDisplay.textContent = pressure.toFixed(1);
}

// ì‹œë®¬ë ˆì´ì…˜
function runSimulationStep(){
    totalSimulatedSeconds += 60;
    let randomChange = (Math.random()-0.5)*5;
    currentProb = Math.max(0, Math.min(100, currentProb + randomChange));
    currentHumidity = Math.max(30, Math.min(100, currentHumidity + (Math.random()-0.5)*5));
    currentPressure += (Math.random()-0.5)*2;
    const statusData = getStatusEmphasis(currentProb);
    updateUI(currentProb, currentHumidity, currentPressure, statusData);
    currentDateTime.textContent = new Date().toLocaleTimeString('ko-KR');
}

// ìœ„ì¹˜ ë° ë‚ ì”¨ API
function fetchWeather(lat, lon){
    fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&appid=${API_KEY}&lang=kr`)
    .then(res=>res.json())
    .then(data=>{
        if(data.name) locationDisplay.textContent = data.name;
        if(data.main && data.main.temp) currentTemp.textContent = Math.round(data.main.temp-273.15)+"Â°C";
        if(data.weather && data.weather[0]) {
            const id = data.weather[0].id;
            if(id>=200 && id<600) weatherIcon.textContent="ğŸŒ§ï¸";
            else if(id>=600 && id<700) weatherIcon.textContent="â„ï¸";
            else weatherIcon.textContent="â˜€ï¸";
        }
        if(data.main.humidity) currentHumidity = data.main.humidity;
        if(data.main.pressure) currentPressure = data.main.pressure;
        runSimulationStep();
        setInterval(runSimulationStep, 60000);
    })
    .catch(err=>{
        console.error(err);
        locationDisplay.textContent = "ìœ„ì¹˜ ì ‘ê·¼ ë¶ˆê°€. ìˆ˜ë™ ì…ë ¥í•˜ì„¸ìš”.";
        runSimulationStep();
        setInterval(runSimulationStep, 60000);
    });
}

// ìœ„ì¹˜ ì¸ì‹
function getLocation(){
    if(navigator.geolocation){
        navigator.geolocation.getCurrentPosition(pos=>{
            const lat = pos.coords.latitude;
            const lon = pos.coords.longitude;
            fetchWeather(lat, lon);
        }, err=>{
            console.warn(err);
            locationDisplay.textContent = "ìœ„ì¹˜ ì ‘ê·¼ ë¶ˆê°€. ìˆ˜ë™ ì…ë ¥í•˜ì„¸ìš”.";
            runSimulationStep();
            setInterval(runSimulationStep,
