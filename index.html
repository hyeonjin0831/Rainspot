<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Rainspot - ìœ„ì¹˜ ê¸°ë°˜ ë‚ ì”¨ ì˜ˆì¸¡</title>
  <style>
    body { font-family: 'Pretendard', sans-serif; text-align: center; background: #f5f7fa; color: #333; padding: 50px; }
    h1 { color: #0078ff; }
    #location, #coords, #weather { margin-top: 20px; font-size: 18px; }
    #error { color: red; margin-top: 20px; }
  </style>
</head>
<body>
  <h1>ğŸŒ¦ï¸ Rainspot</h1>
  <p id="status">ğŸ“ ìœ„ì¹˜ ì ‘ê·¼ ì¤‘...</p>
  <div id="coords"></div>
  <div id="location"></div>
  <div id="weather"></div>
  <div id="error"></div>

  <script>
    const apiKey = "91a2f1400f6b1f48086f5880e764a966";

    function getLocation() {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(showPosition, showError);
      } else {
        document.getElementById("status").textContent = "ì´ ë¸Œë¼ìš°ì €ëŠ” ìœ„ì¹˜ ì •ë³´ë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.";
      }
    }

    async function showPosition(position) {
      const lat = position.coords.latitude;
      const lon = position.coords.longitude;
      document.getElementById("coords").textContent = `ìœ„ë„: ${lat.toFixed(4)}, ê²½ë„: ${lon.toFixed(4)}`;

      try {
        // ì—­ì§€ì˜¤ì½”ë”©: ì¢Œí‘œ â†’ í–‰ì •ì£¼ì†Œ
        const geoResponse = await fetch(`https://api.openweathermap.org/geo/1.0/reverse?lat=${lat}&lon=${lon}&limit=1&appid=${apiKey}`);
        const geoData = await geoResponse.json();

        if (geoData && geoData.length > 0) {
          const location = geoData[0];
          const city = location.name || "ì•Œ ìˆ˜ ì—†ìŒ";
          const country = location.country || "";
          document.getElementById("location").textContent = `ğŸ“ ${country} ${city}`;
        } else {
          document.getElementById("location").textContent = "ìœ„ì¹˜ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.";
        }

        // ë‚ ì”¨ ì •ë³´ í‘œì‹œ
        const weatherResponse = await fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&appid=${apiKey}&units=metric&lang=kr`);
        const weatherData = await weatherResponse.json();
        const temp = weatherData.main?.temp ?? "?";
        const rain = weatherData.rain?.["1h"] ?? 0;
        const desc = weatherData.weather?.[0]?.description ?? "ì •ë³´ ì—†ìŒ";

        document.getElementById("weather").textContent = `ğŸŒ¡ï¸ ${temp}Â°C / â˜” ê°•ìˆ˜ëŸ‰: ${rain}mm / ${desc}`;
        document.getElementById("status").textContent = "âœ… ìœ„ì¹˜ ì¸ì‹ ì™„ë£Œ";

      } catch (error) {
        document.getElementById("error").textContent = "ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.";
      }
    }

    function showError(error) {
      const status = document.getElementById("status");
      switch (error.code) {
        case error.PERMISSION_DENIED:
          status.textContent = "ì‚¬ìš©ìê°€ ìœ„ì¹˜ ì ‘ê·¼ì„ ê±°ë¶€í–ˆìŠµë‹ˆë‹¤.";
          break;
        case error.POSITION_UNAVAILABLE:
          status.textContent = "ìœ„ì¹˜ ì •ë³´ë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.";
          break;
        case error.TIMEOUT:
          status.textContent = "ìš”ì²­ ì‹œê°„ì´ ì´ˆê³¼ë˜ì—ˆìŠµë‹ˆë‹¤.";
          break;
        default:
          status.textContent = "ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.";
      }
    }

    getLocation();
  </script>
</body>
</html>
